INSERT INTO log_defn_parametro VALUES
('geo_smtp_server','SMTP - Server','A', 'C', null, NULL, NULL, '2', 'S', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_smtp_server', 905);

INSERT INTO log_par_cliente VALUES
('geo_smtp_server', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_smtp_port','SMTP - Port','A', 'C', null, NULL, NULL, '2', 'S', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_smtp_port', 905);

INSERT INTO log_par_cliente VALUES
('geo_smtp_port', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_smtp_timeout','SMTP - Timeout','A', 'C', null, NULL, NULL, '2', 'S', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_smtp_timeout', 905);

INSERT INTO log_par_cliente VALUES
('geo_smtp_timeout', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_smtp_protocol','SMTP - Protocol','A', 'C', null, NULL, NULL, '2', 'S', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_smtp_protocol', 905);

INSERT INTO log_par_cliente VALUES
('geo_smtp_protocol', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_smtp_user','SMTP - User','A', 'C', null, NULL, NULL, '2', 'S', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_smtp_user', 905);

INSERT INTO log_par_cliente VALUES
('geo_smtp_user', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_smtp_password','SMTP - Password','A', 'C', null, NULL, NULL, '2', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_smtp_password', 905);

INSERT INTO log_par_cliente VALUES
('geo_smtp_password', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_01','Texto Relatorio Linha 1','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_01', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_01', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_02','Texto Relatorio Linha 2','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_02', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_02', '105');

-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_03','Texto Relatorio Linha 3','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_03', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_03', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_04','Texto Relatorio Linha 4','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_04', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_04', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_05','Texto Relatorio Linha 5','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_05', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_05', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_06','Texto Relatorio Linha 6','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_06', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_06', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_07','Texto Relatorio Linha 7','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_07', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_07', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_08','Texto Relatorio Linha 8','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_08', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_08', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_09','Texto Relatorio Linha 9','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_09', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_09', '105');
 
-----------------------

INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_10','Texto Relatorio Linha 10','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_10', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_10', '105');
 
-----------------------
INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_11','Texto Relatorio Linha 11','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_11', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_11', '105');
 
-----------------------
INSERT INTO log_defn_parametro VALUES
('geo_txt_rel_12','Texto Relatorio Linha 12','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_txt_rel_12', 905);

INSERT INTO log_par_cliente VALUES
('geo_txt_rel_12', '105');
 
-----------------------


INSERT INTO log_defn_parametro VALUES
('geo_cod_caixa_bx_chq','Codigo do caixa para baixa de cheques','A', 'C', null, NULL, NULL, '1', 'N', '105', 'S', 'N', NULL, 'N', 905);

INSERT INTO log_par_rotina VALUES
('geo_cod_caixa_bx_chq', 905);

INSERT INTO log_par_cliente VALUES
('geo_cod_caixa_bx_chq', '105');

INSERT INTO log_help_parametro VALUES
('geo_cod_caixa_bx_chq', '1','Codigo do Caixa do MCX - Movimento de controle de Caixa que sera gravado');

INSERT INTO log_help_parametro VALUES
('geo_cod_caixa_bx_chq', '2','quando ocorrer a baixa de cheques pelo CHQ0015 por movimento de caixa');
------------------

alter table geo_loc_mestre add patrimonio char(30)

create table geo_roteiros
(
cod_empresa char(2),
cod_roteiro decimal(4,0),
seq_visita  integer,
cod_cliente char(15)
);
create index ix_georoteiro on geo_roteiros ( cod_empresa, cod_roteiro, cod_cliente );



create table geo_rot_repres
(
cod_empresa char(2),
cod_repres  decimal(4,0),
cod_roteiro decimal(4,0),
den_roteiro char(30)
);
create index ix_georotrepres on geo_rot_repres ( cod_empresa, cod_repres, cod_roteiro );

create table geo_loc_mestre (
   cod_empresa char(2),
   cod_contrato INTEGER,
   num_nf INTEGER,
   dat_instal DATE,
   ser_fabric CHAR(15),
   cod_cliente CHAR(15),
   cod_repres  decimal(4,0),
   observacao CHAR(999),
   ies_suspenso CHAR(1),
   dat_suspensao DATE,
   ies_emite_nf CHAR(1) ,
   val_loc_mes decimal(20,2),
   cod_cnd_pgto decimal(3,0)
   primary key (cod_empresa, cod_contrato)
);
create index ix_geolocmestre on geo_loc_mestre (cod_empresa, cod_contrato, num_nf);

create table geo_loc_itens (
   cod_empresa char(2),
   cod_contrato integer,
   cod_item char(15),
   primary key (cod_empresa, cod_contrato, cod_item)
);      

create table geo_audit (
   cod_empresa char(2),
   num_programa char(10),
   dat_hor datetime,
   mensagem char(999)
);
create index ix_geoaudit on geo_audit (cod_empresa, num_programa);               

create table geo_ope_env (
   cod_empresa char(2),
   cod_repres decimal(4,0),
   cod_ope integer,
   num_pedido integer,
   nota_fiscal integer,
   serie_nota_fiscal char(3),
   trans_nota_fiscal integer
);
create index ix_geoopeenv on geo_ope_env (cod_empresa, cod_repres, cod_ope);

create table geo_remessa_movto (
   cod_empresa char(2),
   cod_manifesto integer,
   num_remessa integer,
   ser_remessa char(3),
   trans_remessa integer,
   tipo_movto char(1),
   cod_item char(15),
   qtd_movto decimal(20,5),
   num_nf integer,
   ser_nf char(3),
   trans_nota_fiscal integer,
   dat_movto date,
);

CREATE TABLE geo_repres_paramet (
 cod_empresa char(2),
 cod_repres decimal(4,0) NOT NULL,
 tip_docum char(8) NOT NULL,
 serie_docum CHAR(3) NOT NULL,
 ultima_operacao decimal(9,0),
 login_smart char(30),
 senha_smart char(9),
 num_versao char(15),
 num_sistema char(15),
 cod_veiculo decimal(18,0),
 placa_veiculo char(7),
 saldo_cc DECIMAL(20,2),
 cod_cliente char(15),
 saldo_cc_ant DECIMAL(20,2),
 saldo_inicial decimal(20,2),
 PRIMARY KEY (cod_empresa, cod_repres)
);

CREATE TABLE meio_pagto_geosales (
   cod_meio_pgto char(3),
   den_meio_pgto char(30),
   ies_cob char(1),
   ies_valida_doc char(1),
   ies_abate_limcred char(1),
   ies_bol char(1)
);

create table geo_manifesto (
   cod_empresa char(2),
   cod_manifesto integer,
   cod_resp char(15),
   dat_manifesto date,
   cod_transp char(15),
   placa_veic char(8),
   sit_manifesto CHAR(1),
   tip_manifesto CHAR(1),
   periodo_de date,
   periodo_ate date,
   dat_fechamento date,
   primary key (cod_empresa, cod_manifesto)
);

create table geo_rel_chq (
   cod_empresa char(02),
   num_trans_cheque integer,
   num_cheque char(10),
   val_bruto DECIMAL(15,2),
   dat_emissao date,
   dat_vencto  DATE,
   cod_tit_rel char(14)
);

create table geo_acerto (
   cod_empresa char(2),
   cod_manifesto integer,
   cod_cliente char(15),
   num_nf integer,
   ser_nf char(3),
   cod_titulo char(14),
   val_bruto decimal(20,2),
   val_pagto decimal(20,2),
   dat_pagto date,
   portador decimal(4,0),
   val_cheque decimal(20,2),
   val_dinheiro decimal(20,2),
   val_saldo decimal(20,2),
   data_movto date
);

create table geo_acerto_chq (
   cod_empresa char(2),
   cod_manifesto integer,
   sequencia integer,
   cod_titulo char(14),
   num_cheque char(10),
   val_cheque decimal(20,2),
   primary key (cod_empresa, cod_manifesto, sequencia)
);

create table geo_acerto_despesas (
   cod_empresa char(2),
   cod_manifesto integer,
   sequencia integer,
   cod_operacao DECIMAL(5,0),
   cod_cc CHAR(4),
   num_docum CHAR(15),
   val_despesa decimal(20,2),
   descricao char(500)
   primary key (cod_empresa, cod_manifesto, sequencia)
);

create table geo_acerto_dhr (
   cod_empresa char(2),
   cod_manifesto integer,
   val_dinheiro decimal(20,2),
   primary key (cod_empresa, cod_manifesto)
);

CREATE TABLE geo_oper_mcx_portador (
   cod_empresa CHAR(2),
   operacao DECIMAL(5,0),
   portador DECIMAL(4,0),
   PRIMARY KEY (cod_empresa, operacao, portador)
);

CREATE TABLE geo_inf_boleto (
   cod_empresa CHAR(2),
   nota_fiscal INTEGER,
   serie_nota_fiscal CHAR(3),
   linha_digitavel CHAR(99),
   num_docum CHAR(14)
);

create table geo_acerto_cobranca (
   cod_empresa char(2),
   cod_manifesto integer,
   cod_manifesto_orig integer,
   cod_cliente char(15),
   num_nf integer,
   ser_nf char(3),
   cod_titulo char(14),
   val_bruto decimal(20,2),
   val_pagto decimal(20,2),
   dat_pagto date,
   portador decimal(4,0),
   val_cheque decimal(20,2),
   val_dinheiro decimal(20,2),
   val_saldo decimal(20,2)
);

create table geo_acerto_chq_cobr (
   cod_empresa char(2),
   cod_manifesto integer,
   cod_manifesto_orig integer,
   sequencia integer,
   cod_titulo char(14),
   num_cheque char(10),
   val_cheque decimal(20,2),
   primary key (cod_empresa, cod_manifesto, sequencia)
);
create table geo_reprocessa_boleto (
   trans_nota_fiscal integer,
   primary key (trans_nota_fiscal)
);

CREATE TABLE geo_loc_faturado (
   cod_empresa char(2),
   cod_contrato integer,
   num_nf integer,
   cod_cliente char(15),
   cod_repres decimal(4,0),
   data_process DATE,
   periodo_de DATE,
   periodo_ate DATE,
   valor DECIMAL(20,2),
   num_pedido decimal(6,0),
   primary key (cod_empresa, cod_contrato, num_nf, cod_cliente, cod_repres, periodo_de, periodo_ate)
);

CREATE TABLE geo_acerto_cc (
   cod_empresa char(2),
   cod_manifesto integer,
   saldo_atual decimal(20,2),
   saldo_anterior decimal(20,2),
   primary key (cod_empresa, cod_manifesto)
);


CREATE TABLE geo_manifesto_ar (
	cod_empresa char(2),
	cod_manifesto integer,
	num_aviso_rec integer,
	primary key (cod_empresa, cod_manifesto)
);


######## PROCEDURE PARA ARRUMAR MOVIMENTAÇÔES QUE NAO FORAM GERADAS #########
CREATE PROCEDURE geo_proc_fix_movto
as
		
	DECLARE @cod_empresa CHAR(02)
	DECLARE @cod_item CHAR(15)
	DECLARE @qtd_item DECIMAL(15,2)
	DECLARE @cod_repres DECIMAL(4,0)
	DECLARE @cod_ope INT
	DECLARE @num_pedido DECIMAL(6,0)
	DECLARE @dat_pedido DATETIME
	DECLARE @nota_fiscal INT
	DECLARE @num_remessa INT
	DECLARE @cod_manifesto INT
	DECLARE @serie_nota_fiscal CHAR(03)
	DECLARE @ser_remessa CHAR(03)
	DECLARE @dat_hor_emissao DATETIME
	DECLARE @trans_nota_fiscal INT	
	DECLARE @trans_remessa INT	
	
	DECLARE cq_notas CURSOR LOCAL STATIC READ_ONLY FORWARD_ONLY FOR
	SELECT a.cod_empresa,
	       a.cod_repres,
	       a.cod_ope,
	       a.num_pedido,
	       g.dat_pedido,
	       a.nota_fiscal,
	       a.serie_nota_fiscal,
	       b.dat_hor_emissao,
	       a.trans_nota_fiscal
	  FROM geo_ope_env a, fat_nf_mestre b, fat_nf_repr f, pedidos g
	 WHERE a.cod_empresa = '01'
	   AND a.cod_empresa = b.empresa
	   AND a.cod_empresa = f.empresa
	   AND a.trans_nota_fiscal = b.trans_nota_fiscal
	   AND b.trans_nota_fiscal = f.trans_nota_fiscal
	   AND b.sit_nota_fiscal = 'N'
	   AND g.cod_empresa = a.cod_empresa
	   AND g.num_pedido = a.num_pedido
	   AND NOT EXISTS (SELECT c.trans_nota_fiscal
	                     FROM geo_remessa_movto c, geo_manifesto d, geo_repres_paramet e
		                WHERE c.cod_empresa = d.cod_empresa
		                  AND c.cod_manifesto = d.cod_manifesto
		                  AND d.cod_resp = e.cod_cliente
		                  AND e.cod_repres = a.cod_repres
		                  AND c.trans_nota_fiscal = a.trans_nota_fiscal);
	OPEN cq_notas
	FETCH NEXT FROM cq_notas INTO  @cod_empresa,
	       						   @cod_repres,
							       @cod_ope,
							       @num_pedido,
							       @dat_pedido,
							       @nota_fiscal,
							       @serie_nota_fiscal,
							       @dat_hor_emissao,
							       @trans_nota_fiscal
    WHILE @@FETCH_STATUS = 0
    BEGIN
    
    
		DELETE 
		  FROM geo_remessa_movto 
		 WHERE cod_empresa = @cod_empresa 
		   AND trans_nota_fiscal = @trans_nota_fiscal;
		
		SET @cod_manifesto = (SELECT TOP 1 cod_manifesto
	      						FROM geo_manifesto
							   WHERE cod_empresa = @cod_empresa
							     AND dat_manifesto <= @dat_hor_emissao
							     AND cod_resp IN (SELECT cod_cliente FROM geo_repres_paramet WHERE cod_repres = @cod_repres)
							   ORDER BY dat_manifesto DESC);
		
		DECLARE cq_dados_remessa CURSOR LOCAL STATIC READ_ONLY FORWARD_ONLY FOR				
		SELECT TOP 1 num_remessa,
		       ser_remessa,
		       trans_remessa
		  FROM geo_remessa_movto
		 WHERE cod_empresa = @cod_empresa
		   AND cod_manifesto = @cod_manifesto
		   AND tipo_movto = 'E'
		OPEN cq_dados_remessa
		FETCH NEXT FROM cq_dados_remessa INTO  @num_remessa,
		       								   @ser_remessa,
											   @trans_remessa
		CLOSE cq_dados_remessa
		DEALLOCATE cq_dados_remessa
		
		DECLARE cq_itens CURSOR LOCAL STATIC READ_ONLY FORWARD_ONLY FOR
		SELECT item, 
		       qtd_item
		  FROM fat_nf_item
		 WHERE empresa = @cod_empresa
		   AND trans_nota_fiscal = @trans_nota_fiscal
		
		OPEN cq_itens
		FETCH NEXT FROM cq_itens INTO  @cod_item,
								       @qtd_item
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT INTO geo_remessa_movto VALUES (@cod_empresa,
			                                      @cod_manifesto,
			                                      @num_remessa,
			                                      @ser_remessa,
			                                      @trans_remessa,
			                                      'S',
			                                      @cod_item,
			                                      @qtd_item,
			                                      @nota_fiscal,
			                                      @serie_nota_fiscal,
			                                      @trans_nota_fiscal,
			                                      @dat_pedido)
		
			
			  
			FETCH NEXT FROM cq_itens INTO  @cod_item,
									       @qtd_item
			
			
		END
		
		CLOSE cq_itens
		DEALLOCATE cq_itens
		
		FETCH NEXT FROM cq_notas INTO  @cod_empresa,
	       						   	   @cod_repres,
								       @cod_ope,
								       @num_pedido,
								       @dat_pedido,
								       @nota_fiscal,
								       @serie_nota_fiscal,
								       @dat_hor_emissao,
								       @trans_nota_fiscal
	END
	CLOSE cq_notas
	DEALLOCATE cq_notas;
### FIM DA PROCEDURE